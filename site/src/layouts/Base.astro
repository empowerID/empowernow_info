---
const { title = 'EmpowerNow', description = 'Identity & Authorization Fabric', canonical = '/', ogImage, hreflangs } = Astro.props as any;
import '../styles/tokens.css';
import '../styles/utilities.css';
---
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>{title}</title>
		<meta name="description" content={description} />
		<link rel="canonical" href={new URL(canonical, Astro.site)} />
		{hreflangs && hreflangs.map((h: { href: string; lang: string }) => <link rel="alternate" hrefLang={h.lang} href={h.href} />)}
		<link rel="icon" href="/favicon.svg" />
		{ogImage && <meta property="og:image" content={ogImage} />}
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
		<style>
			html,body{margin:0;background:var(--navy);color:#fff;font-family:Inter,-apple-system,sans-serif}
			main{min-height:60vh}
			footer{border-top:1px solid rgba(255,255,255,.1);padding:32px 0;margin-top:48px}
			nav{position:sticky;top:0;z-index:1000}
			.consent{position:fixed;bottom:16px;left:16px;right:16px;z-index:1100}
		</style>
	</head>
	<body>
		<nav>
			<div class="container wrap" style="display:flex;justify-content:space-between;align-items:center;padding:16px 0">
				<a href="/" style="color:var(--color-accent);font-weight:700;text-decoration:none">EmpowerNow</a>
				<ul class="nav-links">
					<li><a href="/products/">Products</a></li>
					<li><a href="/solutions/">Solutions</a></li>
					<li><a href="/resources/">Resources</a></li>
					<li><a href="https://empowerid.github.io/empowernow_docs/" target="_blank" rel="noopener">Docs</a></li>
					<li><a href="/pricing/">Pricing</a></li>
					<li><a href="/company/">Company</a></li>
					<li><a class="btn btn-primary" href="/demo/" data-ev="cta_click" data-label="nav_demo">Book Demo</a></li>
				</ul>
			</div>
		</nav>
		<main>
			<slot />
		</main>
		<footer>
			<div class="container" style="display:flex;justify-content:space-between;align-items:center">
				<div>Â© {new Date().getFullYear()} EmpowerNow</div>
				<div style="display:flex;gap:16px"><a href="/trust/">Trust</a><a href="/resources/">Resources</a></div>
			</div>
		</footer>
		<div id="consent" class="consent" hidden>
			<div class="glass-card" style="padding:12px;display:flex;justify-content:space-between;align-items:center;gap:12px">
				<div style="color:#9ba3b7">We use analytics to improve your experience.</div>
				<div style="display:flex;gap:8px">
					<button id="consent-accept" class="btn btn-primary">Allow</button>
					<button id="consent-decline" class="btn">Decline</button>
				</div>
			</div>
		</div>
		<script>
			(function(){
				try{
					const consentKey = 'analytics_consent';
					const consentEl = document.getElementById('consent');
					const acceptBtn = document.getElementById('consent-accept');
					const declineBtn = document.getElementById('consent-decline');
					const has = localStorage.getItem(consentKey);
					if(!has && consentEl){ consentEl.hidden = false; }
					function setConsent(val){ localStorage.setItem(consentKey, val); if(consentEl) consentEl.hidden = true; }
					acceptBtn && acceptBtn.addEventListener('click', function(){ setConsent('yes'); });
					declineBtn && declineBtn.addEventListener('click', function(){ setConsent('no'); });
					document.addEventListener('click', function(e){
						const t = e.target as HTMLElement;
						const el = t && (t.closest('[data-ev]') as HTMLElement | null);
						if(!el) return;
						if(localStorage.getItem(consentKey) !== 'yes') return;
						const type = el.getAttribute('data-ev');
						const label = el.getAttribute('data-label') || '';
						const position = el.getAttribute('data-position') || '';
						(window as any).dataLayer = (window as any).dataLayer || [];
						(window as any).dataLayer.push({ event: type, label, position, page: location.pathname });
					});
				}catch{}
			})();
		</script>
	</body>
</html>
